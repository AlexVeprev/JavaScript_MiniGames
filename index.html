<!DOCTYPE html>
<html>
  <head>
    <title>AV: JavaScript MiniGames</title>
    <link rel="stylesheet" type="text/css" href="style.css">

      <script type="text/javascript">
        var timer = null;
        var game = null;
        var canvas = null;

        function startTimer() {
          if (game) {
            var interval = 10;
            timer = setInterval(game.step, interval);
            return;
          }
          alert("Nothing to start.")
        }

        function stopTimer() {
          if (timer) {
            clearInterval(timer);
          }
        }

        function chooseGame() {
          var chosenGame = "Game of life";
          canvas = document.getElementById("canvas");

          if (chosenGame == "Game of life") {
            game = startGameOfLife(canvas, 30, 30);
            game.registerGameOverCallback(gameOver);
          }
        }

        function step() {
          if (game) {
            game.step();
          }
        }

        function reset() {
          if (game) {
            game.reset();
          }
        }

        function GameOfLife_randomGeneration() {
          if (game) {
            game.random(0.5);
          }
        }

        function gameOver() {
          stopTimer();
        }

        function relMouseCoords(event) {
          var totalOffsetX = 0;
          var totalOffsetY = 0;
          var canvasX = 0;
          var canvasY = 0;
          var currentElement = this;

          do {
            totalOffsetX += currentElement.offsetLeft - currentElement.scrollLeft;
            totalOffsetY += currentElement.offsetTop - currentElement.scrollTop;
          }
          while (currentElement = currentElement.offsetParent)

          canvasX = event.pageX - totalOffsetX;
          canvasY = event.pageY - totalOffsetY;

          return {x:canvasX, y:canvasY}
        }
        HTMLCanvasElement.prototype.relMouseCoords = relMouseCoords;

        function handleClick(event) {
          var coords = canvas.relMouseCoords(event);
          game.handleClick(coords.x, coords.y);
        }
      </script>

      <script type="text/javascript" src="MatrixPainter.js"></script>
      <script type="text/javascript" src="GameOfLife.js"></script>
  </head>

<body onload=chooseGame();>
  <table id="content">
    <tr>
      <td id="controls">
        <table id="general_controls">
          <caption>General controls</caption>
          <tr>
            <td><div class="button" onclick="startTimer();" id="btn_start" >Start</div></td>
            <td><div class="button" onclick="stopTimer();"  >Pause</div></td>
            <td><div class="button" onclick="reset();"      >Reset</div></td>
          </tr>
        </table>
        <table id="game_of_life_controls">
          <caption>Game of Life</caption>
          <tr>
            <td><div class="button" onclick="step();"       >Step</div></td>
            <td><div class="button" onclick="GameOfLife_randomGeneration();"       >Random generation</div></td>
          </tr>
        </table>
      </td>
      <td id="game_field">
        <canvas id="canvas" onclick="handleClick(event);" onselectstart="return false" onmousedown="return false"></canvas>
      </td>
    </tr>
  </table>
</body>
</html>